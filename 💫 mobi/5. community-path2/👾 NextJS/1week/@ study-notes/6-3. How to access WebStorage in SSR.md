<p align="center"><img src="https://github.com/JeongwooHam/FE_Study_Logs/assets/123251211/ab4a13a7-d964-4e42-ac50-f37084b6cf14" width="60%"/></p>

## ğŸš¨ ReferenceError: [localStorage is not defined](https://github.com/vercel/next.js/discussions/19911)

```js
import { useState } from "react";

export default function Home() {
  let value;

  value = localStorage.getItem("pw") || "";

  const [pw, setPw] = useState(value);

  const saveToLocalStorage = (e) => {
    e.preventDefault();
    localStorage.setItem("password", pw);
  };

  return (
    <div>
      <label htmlFor="pw">Write your password here.</label>
      <form onSubmit={saveToLocalStorage}>
        <input
          id="pw"
          type="password"
          value={pw}
          onChange={(e) => setPw(e.target.value)}
        />
        <button type="submit"></button>
      </form>
    </div>
  );
}
```

ìœ„ì™€ ê°™ì´ ë¹„ë°€ë²ˆí˜¸ë¥¼ localStorageì— ì €ì¥í•˜ëŠ” ì½”ë“œë¥¼ Next.js í”„ë¡œì íŠ¸ì—ì„œ ì‘ì„±í–ˆë‹¤ê³  ê°€ì •í•´ë³´ì.
ê·¸ë¦¬ê³  ì´ ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´,

```
ReferenceError: localStorage is not defined
```

ì´ëŸ¬í•œ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

### ğŸ¤” ì™œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ì¼ê¹Œ?

1. Next.jsëŠ” Client-Sideë¥¼ ë Œë”ë§í•˜ê¸° ì „ Server-Side ë Œë”ë§ì„ ìˆ˜í–‰í•œë‹¤.
2. Next.jsì—ì„œ ì œê³µí•˜ëŠ” SSRì—ì„œëŠ” window, documentì™€ ê°™ì€ ë¸Œë¼ìš°ì € ì „ì—­ ê°ì²´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.
3. window ê°ì²´ëŠ” Client-Sideì—ë§Œ ì¡´ì¬í•œë‹¤.
   - WebStorageëŠ” windowì˜ ê°ì²´ì´ë‹¤.
   - í˜ì´ì§€ê°€ í´ë¼ì´ì–¸íŠ¸ì— ë¡œë“œë˜ê³ , window ê°ì²´ê°€ ì •ì˜ë˜ê¸° ì „ê¹Œì§€ëŠ” <code>window.localStorage</code>ì— ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤.
4. ë”°ë¼ì„œ ì½”ë“œê°€ ì„œë²„ì—ì„œ ì»´íŒŒì¼ ë  ë•Œ, localStorage ê°ì²´ê°€ ì¡´ì¬í•˜ì§€ ì•Šì•„ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ” ê²ƒì´ë‹¤.

### ğŸ§ ì–´ë–»ê²Œ í•´ê²°í•  ìˆ˜ ìˆì„ê¹Œ?

- ì´ëŸ¬í•œ ì—ëŸ¬ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” localStorageì— ì ‘ê·¼í•˜ê¸° ì „ì— í´ë¼ì´ì–¸íŠ¸ ì¸¡ì— í˜ì´ì§€ê°€ ë§ˆìš´íŠ¸ ë  ë–„ê¹Œì§€ ê¸°ë‹¤ë ¤ì•¼ í•œë‹¤.

> <code>typeof window !== 'undefined'</code>

- window ê°ì²´ê°€ ì •ì˜ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ë°©ë²•

```js
if (typeof window !== "undefined") {
  // localStorage ê´€ë ¨ ì‘ì—… ìˆ˜í–‰ ì½”ë“œ
  value = localStorage.getItem("pw") || "";
}
```

- í˜ì´ì§€ê°€ Client-Sideì— ë§ˆìš´íŠ¸ ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¸ë‹¤ê°€ localStorageì— ì ‘ê·¼í•œë‹¤.
- window ê°ì²´ê°€ ì°¸ì¡°ë˜ì§€ ì•Šì„ ê²½ìš° undefinedë¥¼ ë°˜í™˜í•œë‹¤.
  - localStorageëŠ” window ê°ì²´ ë‚´ë¶€ì˜ ê°ì²´ì´ë¯€ë¡œ window ê°ì²´ê°€ ì •ì˜ë˜ì§€ ì•Šì€ ì„œë²„ì—ì„œëŠ” localStorage ê´€ë ¨ ì½”ë“œê°€ ì‹¤í–‰ë˜ì§€ ì•Šì„ ê²ƒì´ë‹¤.
- ì´ë¥¼ í†µí•´ localStorageì— ì ‘ê·¼í•˜ê¸° ì „ localStorageê°€ ì •ì˜ëœ ìƒíƒœë¼ëŠ” ê²ƒì„ ë³´ì¥í•œë‹¤.

> typeofì˜ í™•ì¥; classë¡œ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ê¸°

```js
class LocalStorage {
  constructor() {}

  static setItem(key: string, item: string) {
    if (typeof window !== "undefined") {
      localStorage.setItem(key, item);
    }
  }

  static getItem(key: string) {
    if (typeof window !== "undefined") {
      return localStorage.getItem(key);
    }
    return null;
  }

  static removeItem(key: string) {
    if (typeof window !== "undefined") {
      localStorage.removeItem(key);
    }
  }
}

export default LocalStorage;
```

- ìœ„ì™€ ê°™ì´ localStorage ê´€ë ¨ ë©”ì„œë“œë¥¼ í´ë˜ìŠ¤ë¡œ ì„ ì–¸í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```js
// ì‚¬ìš©ë°©ë²•
import LocalStorage from "../";

const saveToLocalStorage = (e) => {
  if (!e.target.value) return;
  e.preventDefault();
  LocalStorage.setItem("password", pw);
};
```

> <code>try-catch</code> ë¬¸ ì‚¬ìš©í•˜ê¸°

```js
try {
  value = localStorage.getItem("pw") || "";
} catch (error) {}
```

- ë‹¨ìˆœí•˜ê²Œ try catch ë¸”ë¡ìœ¼ë¡œ localStorage ì ‘ê·¼ ì½”ë“œë¥¼ ê°ìŒ€ ìˆ˜ ìˆë‹¤.

> ğŸŒŸ <code>useEffect</code>

    ğŸ‘©â€ğŸ« ìœ„ì˜ ë°©ì‹ë“¤ë³´ë‹¤ ë” "React"ìŠ¤ëŸ¬ìš´ í•´ê²°ì±…ì…ë‹ˆë‹¤.

```js
import { useEffect } from "react";

useEffect(() => {
  // localStorage ê´€ë ¨ ì‘ì—… ìˆ˜í–‰ ì½”ë“œ
  value = localStorage.getItem("pw") || "";
}, []);
```

- useEffectëŠ” ë§ˆìš´íŠ¸ ë˜ì—ˆì„ ë•Œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— CSR ì „ìš© í›… í•¨ìˆ˜ì´ë‹¤.
  - ì´ ë•Œë¬¸ì— ë¸Œë¼ìš°ì €ë¼ëŠ” í™•ì‹ ì„ ì¤„ ìˆ˜ ìˆê³ , **_not defined_**ë¼ëŠ” ì—ëŸ¬ì— ëŒ€í•œ ìš°ë ¤ ì—†ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- useEffectëŠ” ë Œë”ë§ ì‹œ ì‹¤í–‰ë˜ë¯€ë¡œ ì´ˆê¸° ì„œë²„ ë¹Œë“œ ì‹œì— useEffect ë‚´ë¶€ì— ìœ„ì¹˜í•œ ì½”ë“œëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠëŠ”ë‹¤.
- useEffectëŠ” Client-Sideì—ì„œë§Œ ì‹¤í–‰ë˜ë¯€ë¡œ localStorageì— ì•ˆì „í•˜ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.

## ğŸ” References

<details>
<summary>ì°¸ê³  ìë£Œ ëª¨ìŒ</summary>
<div markdown="1">

- [[Next.js] localStorage ì´ìŠˆ](https://velog.io/@dngur9801/Next.js-localStorage-%EC%9D%B4%EC%8A%88)
- [How to Fix "localStorage is not defined" in Next.js](https://developer.school/snippets/react/localstorage-is-not-defined-nextjs#scenario)
- [[Next] localstorageë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²• #1](https://all-dev-kang.tistory.com/entry/Next-localstorage%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95)
- [[nextJS] localStorage ì‚¬ìš©í•˜ê¸°](https://chunho.tistory.com/60)
- [How to use Local Storage in Next.js](https://dev.to/collegewap/how-to-use-local-storage-in-nextjs-2l2j)
- [How to deal with local storage and SSR?](https://stackoverflow.com/questions/63312727/how-to-deal-with-local-storage-and-ssr)
- [localStorage is not defined in next js](https://stackoverflow.com/questions/76070793/localstorage-is-not-defined-in-next-js)
</div>
</details>
